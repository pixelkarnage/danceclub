{namespace t=PlanT\Danceclub\ViewHelpers}
{namespace core=TYPO3\CMS\Core\ViewHelpers}
{namespace bu=TYPO3\CMS\Beuser\ViewHelpers}

<f:layout name="Backend/Default" />

<f:section name="content">
<f:be.pageRenderer pageTitle="{f:translate(key:'LLL:EXT:danceclub/Resources/Private/Language/locallang_be.xlf:administration.pageTitle')}" loadExtJs="1" loadExtJsTheme="1" enableExtJsDebug="1" loadJQuery="1" />
<t:includeFile path="../typo3conf/ext/danceclub/Resources/Public/Css/administration.css" />
<t:includeFile path="../typo3conf/ext/danceclub/Resources/Public/Js/sorttable.js" />

<script language="javascript" type="text/javascript">
			function showDetails(obj) {
	    		var el = document.getElementById(obj);
	   		 	if ( el.style.display != "none" ) {
	        		el.style.display = 'none';
	    		}
	    		else {
	       	 		el.style.display = '';
	    		}
			}
</script>

	<f:if condition="{events}">
		<f:then>
		<f:for each="{events}" as="event">
			<h2><core:icon identifier="danceclub-calendar-o" size="large" /> {event.name} <f:if condition="{event.teachers -> f:count()}>=1">
				<f:then>
				<h4><f:for each="{event.teachers}" as="teacher" iteration="iterator">{teacher.name} <f:if condition="{iterator.isLast}"><f:then></f:then><f:else> &amp; </f:else></f:if></f:for></h4>
				</f:then>
				<f:else><i><f:translate key="LLL:EXT:danceclub/Resources/Private/Language/locallang_be.xlf:administration.noTeachers" /></i></f:else>
			</f:if></h2>
			<h5>
			<div class="btn-group" role="group">

				<f:if condition="{event.bookings}"><f:then>
					<a class="btn btn-default" onclick="showDetails('showMails{event.uid}');"><core:icon identifier="danceclub-envelope" size="small" /> <f:translate key="LLL:EXT:danceclub/Resources/Private/Language/locallang_be.xlf:administration.sendMailAll" /></a>
				</f:then></f:if>

				<f:if condition="{event.bookable}">
					<f:then>
						<a class="btn btn-default" href="#"><core:icon identifier="danceclub-plus" size="small" /> <f:translate key="LLL:EXT:danceclub/Resources/Private/Language/locallang_be.xlf:administration.newBookingRecord" /></a>
						<a class="btn btn-default" href="#"><core:icon identifier="danceclub-cloud-download" size="small" /> Send List to Google Drive</a>
					</f:then>
				</f:if>
				<t:be.editRecord class="btn btn-default" parameters="edit[tx_danceclub_domain_model_event][{event.uid}]=edit" title="Bearbeiten"><core:icon identifier="actions-open" size="small" /> {event.name}</t:be.editRecord>
			</div>
			</h5>

			<f:if condition="{event.bookings}">
			<f:then>
			<f:render partial="Administration/RenderEmails" arguments="{event:event}" />
			<table class="table table-striped table-hover danceclub-eventgroup-list sortable" data-table="pages" id="danceclub-bookings-list">
			<thead>
				<th class="col-nowrap" nowrap="nowrap">#</th>
				<th class="col-icon" nowrap="nowrap"></th>
				<!--<th class="col-nowrap" nowrap="nowrap"><f:translate key="LLL:EXT:danceclub/Resources/Private/Language/locallang_be.xlf:administration.crdate" /></th>-->
				<th class="col-title" nowrap="nowrap"><f:translate key="LLL:EXT:danceclub/Resources/Private/Language/locallang_db.xlf:tx_danceclub_domain_model_booking.name" /></th>
				<th class="col-nowrap" nowrap="nowrap"><f:translate key="LLL:EXT:danceclub/Resources/Private/Language/locallang_db.xlf:tx_danceclub_domain_model_booking.dance_style" /></th>
				<th class="col-nowrap" nowrap="nowrap"><f:translate key="LLL:EXT:danceclub/Resources/Private/Language/locallang_db.xlf:tx_danceclub_domain_model_booking.student" /></th>
				<th class="col-nowrap" nowrap="nowrap"><f:translate key="LLL:EXT:danceclub/Resources/Private/Language/locallang_db.xlf:tx_danceclub_domain_model_booking.invoice_amount" /></th>
				<th class="col-icon" nowrap="nowrap"></th>
			</thead>
			<tbody>
				<f:for each="{event.bookings}" as="booking" iteration="counter">
				<tr>
					<td>{counter.cycle}.</td>
					<td><core:icon identifier="danceclub-tag" size="small" /></td>
					<!--td>{booking.crdate}</td>-->
					<td>{booking.name}</td>
					<td><core:icon identifier="danceclub-danceStyle-{booking.danceStyle}" size="small" /><f:translate key="LLL:EXT:danceclub/Resources/Private/Language/locallang_db.xlf:tx_danceclub_domain_model_booking.dance_style.{booking.danceStyle}" /></td>
					<td><f:if condition="{booking.student}"><f:then><core:icon identifier="danceclub-check-square-o" size="small" /></f:then></f:if></td>
					<td>{booking.invoiceAmount}.- Chf</td>
					<td class="col-control" nowrap="nowrap">
                    	<div class="btn-group" role="group">
                    		<a class="btn btn-default" href="mailto:{booking.email}" title="E-Mail schreiben"><core:icon identifier="danceclub-envelope-o" size="small" /></a>
                    		<a class="btn btn-default" href="#" title=""><core:icon identifier="danceclub-fax" size="small" /></a>
                    		<t:be.editRecord class="btn btn-default" parameters="edit[tx_danceclub_domain_model_booking][{booking.uid}]=edit" title="Buchung bearbeiten"><core:icon identifier="actions-open" size="small" /></t:be.editRecord>
                    		<a class="btn btn-default" href="#"><core:icon identifier="actions-delete" size="small" /></a>
                    	</div>
					</td>
				</tr>
				</f:for>
			</tbody>
			</table>
			</f:then>
			<f:else>
				<f:if condition="{event.bookable}">
					<f:then><i>Keine Buchungen für diese Veranstaltung</i></f:then>
					<f:else><i>Buchung deaktiviert</i></f:else>
				</f:if>
			</f:else>
			</f:if>
		</f:for>
		</f:then>
		<f:else>
		<i>Keine Veranstaltungen für dieses Kursprogramm</i>
		</f:else>
	</f:if>


</f:section>
